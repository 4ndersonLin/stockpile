---

- id: 300157e5-f4ad-4569-b533-9d1fa0e74d74
  name: Compress staged directory
  description: Compress a directory on the file system
  tactic: exfiltration
  technique:
    attack_id: T1002
    name: Data Compressed
  platforms:
    darwin:
      sh:
        command: |
          tar -P -zcf #{host.dir.staged}.tar.gz #{host.dir.staged} && echo #{host.dir.staged}.tar.gz
        cleanup: |
          rm #{host.dir.staged}.tar.gz
        parsers:
          plugins.stockpile.app.parsers.basic:
            - source: host.dir.compress
    linux:
      sh:
        command: |
          tar -P -zcf #{host.dir.staged}.tar.gz #{host.dir.staged} && echo #{host.dir.staged}.tar.gz
        cleanup: |
          rm #{host.dir.staged}.tar.gz
        parsers:
          plugins.stockpile.app.parsers.basic:
            - source: host.dir.compress
    windows:
      psh,pwsh:
        command: |
          Compress-Archive -Path #{host.dir.staged} -DestinationPath #{host.dir.staged}.zip -Force;
<<<<<<< HEAD
          ls #{host.dir.staged}.zip | foreach {$_.FullName} | select
=======
          sleep 1; ls #{host.dir.staged}.zip | foreach {$_.FullName} | select
>>>>>>> a2b4f2d02f7a96ebd241898b844e9a36dfccc6be
        cleanup: |
          rm #{host.dir.staged}.zip
        parsers:
          plugins.stockpile.app.parsers.basic:
<<<<<<< HEAD
            - source: host.dir.compress
=======
            - source: host.dir.compress
  requirements:
    - plugins.stockpile.app.requirements.paw_provenance:
      - source: host.dir.staged
>>>>>>> a2b4f2d02f7a96ebd241898b844e9a36dfccc6be
